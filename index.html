<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no" />
	<title>Elements Crusader</title>
	<style type="text/css">
body {
	margin: 0;
	background-color: black;
	color: white;
	overflow: hidden;
	width:100%;
	height:100%;
	text-align: center;
}

canvas {
	width: 90%;
	-webkit-touch-callout: none;
	-webkit-user-select: none;
	-khtml-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	user-select: none;
	outline: none;
	-webkit-tap-highlight-color: rgba(255, 255, 255, 0);
	image-rendering: optimizeSpeed;
	image-rendering: crisp-edges;
    image-rendering: optimize-contrast;
	image-rendering: -moz-crisp-edges;
	image-rendering: -o-crisp-edges;
	image-rendering: -webkit-optimize-contrast;
	-ms-interpolation-mode: nearest-neighbor;
}
	</style>
</head>
<body>
	<canvas id="play" width="640" height="360">
		Your browser doesn't support canvas! :(
	</canvas>
	<script type="text/javascript">
document.getElementById('play').addEventListener("click", start);

var score = '0';
var end = '0';
var x = 320;
var go = '';
var color = '#fff';
var fires = [];
var canvas = document.getElementById('play');
var context = canvas.getContext('2d');
context.imageSmoothingEnabled = false;
context.webkitImageSmoothingEnabled = false;
context.mozImageSmoothingEnabled = false;
context.fillStyle = '#fff';
context.strokeStyle = '#fff';
context.textAlign = 'center';
context.font = '30px Arial';

context.fillText("Elements .-. Crusader", 320, 140);
context.fillText("S74r7!", 320, 170);

function start(){
	end = '0';
	tick();
	// TO DO:

	// rysowanie pocisków
	// rysowanie bonusów
	// rysowanie przeciwników x, y, typ
	// rysowanie bossa
	// pomoc: "use arrows and spacebar"
	// koniec wyswietlanie score i restart
}

function background(){
	context.clearRect(0, 0, canvas.width, canvas.height);
	context.beginPath();
	context.moveTo(0, 360);
	context.lineTo(140, 0);
	context.moveTo(640, 360);
	context.lineTo(500, 0);
	context.fill();
	context.stroke();
	context.closePath();
	context.fillText(score, 320, 30);
}

function ending(win){
	end = '1';
	context.clearRect(0, 0, canvas.width, canvas.height);
	if(win == '1') context.fillText("You win!", 320, 140);
	else context.fillText("You lose!", 320, 140);
	context.fillText("Score: "+score, 320, 170);
	context.fillText("Click to reS74r7!", 320, 200);
	score = '0';
	x = '320';
}

function player(){
	context.fillStyle = color;
	context.strokeStyle = color;
	context.beginPath();
	context.arc(x-40, 340, 10, 0, Math.PI * 2);
	context.arc(x+40, 340, 10, 0, Math.PI * 2);
	context.moveTo(x-40, 350);
	context.lineTo(x+40, 350);
	context.stroke();
	context.fill();
	context.closePath();
	context.fillStyle = '#fff';
	context.strokeStyle = '#fff';
}

function tick(){
	if(end == '0') {
		if(go == 'l' && x>60) x-=3;
		else if(go == 'r' && x<580) x+=3;
		background();
		player();
		// odczytywanie tabeli fires
		var i = -1;
		while(fires[++i]) fire(fires[i]);
		//score++;
		window.setTimeout(tick, 1000/30 ); // 60
	}
}

window.addEventListener('keydown',click,false);
window.addEventListener('keyup',noclick,false);

function click(e) {
	switch(e.keyCode){
		case 37:
			go = 'l';
		break;
		case 39:
			go = 'r';
		break;
		case 32:
			//fire({x: x, y: 340, d:1});
			fires[fires.length] = {x: x, y: 340, d:1};
		break;
	}
	e.preventDefault();
}

function noclick(e) {
	switch(e.keyCode){
		case 37:
			go = '';
		break;
		case 39:
			go = '';
		break;
	}
}

function fire(o){
	if(o.y>0 && o.y<360){
		context.beginPath();
		context.arc(o.x, o.y, 5+(o.y/100), 0, Math.PI * 2);
		context.stroke();
		context.fill();
		context.closePath();
		if(o.d==1) o.y-=5;
		else o.y+=5;
		o.x-=(o.x-320)/100;
		return o;
	}
}
	</script>
</body>
</html>