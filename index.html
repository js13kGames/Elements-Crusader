<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no" />
	<title>Elements Crusader</title>
	<style type="text/css">
body {
	margin: 0;
	background-color: black;
	color: white;
	overflow: hidden;
	width:100%;
	height:100%;
	text-align: center;
}

canvas {
	width: 90%;
	-webkit-touch-callout: none;
	-webkit-user-select: none;
	-khtml-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	user-select: none;
	outline: none;
	-webkit-tap-highlight-color: rgba(255, 255, 255, 0);
	image-rendering: optimizeSpeed;
	image-rendering: crisp-edges;
    image-rendering: optimize-contrast;
	image-rendering: -moz-crisp-edges;
	image-rendering: -o-crisp-edges;
	image-rendering: -webkit-optimize-contrast;
	-ms-interpolation-mode: nearest-neighbor;
}
	</style>
</head>
<body>
	<canvas id="p" width="640" height="360">
		Your browser doesn't support canvas! :(
	</canvas>
	<script type="text/javascript">

	// TO DO:

	// rysowanie bossa
	// koniec po zabiciu bosa   wy    swietlanie score i resta   rt

	// efekty graficzne i muzyczne

// Start game
document.getElementById('p').addEventListener("click", start);
// Press button
window.addEventListener('keydown',(function(i){if(i.keyCode==37)go='l';if(i.keyCode==39)go='r';i.preventDefault();}));
// Release button
window.addEventListener('keyup',(function(i){if(i.keyCode==37||i.keyCode==39)go='';if(i.keyCode==32)entities[entities.length]={type:'bullet1',x:player,y:340,color:color};}));


var score, player, go, color, entities, end=1;
var colors = ['#080','#00c','#333','#800'];
var canvas = document.getElementById('p');
var context = canvas.getContext('2d');
context.imageSmoothingEnabled = false;
context.webkitImageSmoothingEnabled = false;
context.mozImageSmoothingEnabled = false;
context.fillStyle = '#fff';
context.strokeStyle = '#fff';
context.textAlign = 'center';
context.font = '30px Arial';

context.fillText("Elements .-. Crusader", 320, 140);
context.fillText("S74r7!", 320, 170);
context.font = '20px Arial';
context.fillText("use arrows and spacebar", 320, 210);
context.font = '30px Arial';

function start(){
	if(end==1){
		score = 0;
		end = 0;
		player = 320;
		go = '';
		color = '#fff';
		entities = [];
		tick();
	}
}

function ending(win){
	end = 1;
	context.clearRect(0, 0, canvas.width, canvas.height);
	if(win == '1') context.fillText("You win!", 320, 140);
	else context.fillText("You lose!", 320, 140);
	context.fillText("Score: "+score, 320, 170);
	context.fillText("Click to reS74r7!", 320, 200);
}

function tick(){
	if(end==0) {
		if(go == 'l' && player>60) player-=3;
		else if(go == 'r' && player<580) player+=3;
		// clean up canvas
		context.clearRect(0, 0, canvas.width, canvas.height);
		// drawing background
		context.beginPath();
		context.moveTo(0, 360);
		context.lineTo(140, 0);
		context.moveTo(640, 360);
		context.lineTo(500, 0);
		context.fill();
		context.stroke();
		context.closePath();
		context.fillText(score, 320, 30);
		// draw other
		var i = -1;
		while(entities[++i]) draw(entities[i]);
		// drawing player in chosen color
		context.fillStyle = color;
		context.strokeStyle = color;
		context.beginPath();
		context.arc(player-30, 340, 10, 0, Math.PI * 2);
		context.arc(player+30, 340, 10, 0, Math.PI * 2);
		context.moveTo(player-30, 350);
		context.lineTo(player+30, 350);
		context.stroke();
		context.fill();
		context.closePath();
		context.fillStyle = '#fff';
		context.strokeStyle = '#fff';
		// spawn
		if(Math.floor(Math.random()*500)>498) entities[entities.length]={type:'bonus',x:Math.random()*1000%340+160,y:1,color:colors[Math.floor(Math.random()*4)]};
		if(Math.floor(Math.random()*500)>495) entities[entities.length]={type:'enemy'+Math.floor(Math.random()*3),x:Math.random()*1000%320+180,y:1};
		if(score==500) console.log('boss');
		// shoot

		// animate
		window.requestAnimationFrame(tick);
	} else if(end==1) ending(0);
	else ending(1);
}

function draw(object){
	if(object.y>0 && object.y<350){
		if(object.type=='bullet1'){
			var data = context.getImageData(object.x, object.y, 1, 1).data;
			if(data[0]==255&&data[1]==255&&data[2]==255) console.log("Trafiony, zatopiony!");
			context.fillStyle = object.color;
			context.beginPath();
			context.arc(object.x, object.y, 3+(object.y/100), 0, Math.PI * 2);
			context.arc(object.x, object.y+2, 3+(object.y/100), 0, Math.PI * 2);
			context.fill();
			context.closePath();
			context.fillStyle = '#fff';
			object.y-=5;
			object.x-=(object.x-320)/100;
		}
		if(object.type=='bullet2'){
			context.beginPath();
			context.arc(object.x, object.y, 5+(object.y/100), 0, Math.PI * 2);
			context.fill();
			context.closePath();
			object.y+=5;
			object.x+=(object.x-320)/100;
		}
		if(object.type=='enemy0'){
			context.beginPath();
			context.moveTo(object.x-20, object.y-20);
			context.arc(object.x, object.y, 5, 1, 2);
			context.moveTo(object.x+20, object.y+20);
			context.arc(object.x, object.y, 5, 1, 2, 1);
			context.fill();
			context.closePath();
			object.y++;
			object.x+=(object.x-320)/500;
			if(object.y>320&&object.x+40>player&&object.x-40<player) end=1;
		}
		if(object.type=='enemy1'){
			context.beginPath();
			context.moveTo(object.x+20, object.y-20);
			context.arc(object.x, object.y, 5, 1, 2);
			context.moveTo(object.x-20, object.y+20);
			context.arc(object.x, object.y, 5, 1, 2, 1);
			context.fill();
			context.closePath();
			object.y++;
			object.x+=(object.x-320)/500;
			if(object.y>320&&object.x+40>player&&object.x-40<player) end=1;
		}
		if(object.type=='enemy2'){
			context.beginPath();
			context.moveTo(object.x-30-(object.y/100), object.y);
			context.bezierCurveTo(object.x, object.y+20, object.x, object.y+20, object.x+30-(object.y/100), object.y);
			context.stroke();
			context.closePath();
			object.y++;
			object.x+=(object.x-320)/500;
			if(object.y>340&&object.x+40>player&&object.x-40<player) end=1;
		}
		if(object.type=='bonus'){
			context.fillStyle = object.color;
			context.beginPath();
			context.arc(object.x, object.y, 5+(object.y/100), 0, Math.PI * 2);
			context.fill();
			context.closePath();
			context.fillStyle = '#fff';
			object.y+=2;
			object.x+=(object.x-320)/250;
			if(object.y>340&&object.x+40>player&&object.x-40<player){
				color = object.color;
				object.y=0;
				score++;
			}
		}
	// Deleting of old entities
	} else entities.splice(entities.indexOf(object), 1);
}
	</script>
</body>
</html>